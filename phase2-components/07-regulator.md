# 07. 레귤레이터 (Voltage Regulator)

## 목차
1. [레귤레이터란?](#1-레귤레이터란)
2. [LDO vs 스위칭 레귤레이터](#2-ldo-vs-스위칭-레귤레이터)
3. [대표적인 레귤레이터](#3-대표적인-레귤레이터)
4. [입출력 전압차와 발열 문제](#4-입출력-전압차와-발열-문제)
5. [드롭아웃 전압 개념](#5-드롭아웃-전압-개념)
6. [입출력 커패시터의 역할](#6-입출력-커패시터의-역할)
7. [실습: ESP32 전원 회로 설계](#7-실습-esp32-전원-회로-설계)
8. [핵심 정리](#핵심-정리)

---

## 1. 레귤레이터란?

레귤레이터(Voltage Regulator)는 **불안정하거나 높은 입력 전압을 일정한 출력 전압으로
변환해주는 부품**입니다.

```
소프트웨어 비유:
레귤레이터는 "입력 검증 미들웨어(Validation Middleware)"와 같습니다.

- 들어오는 값(전압)이 불안정하고 변동이 있어도,
  나가는 값(출력 전압)은 항상 일정하게 유지합니다.
- API 게이트웨이가 다양한 요청을 정규화(normalize)하여
  백엔드에 일정한 형식으로 전달하는 것과 비슷합니다.

function regulator(inputVoltage) {
    if (inputVoltage >= minRequired) {
        return FIXED_OUTPUT;  // 항상 3.3V 또는 5V
    } else {
        return ERROR;  // 입력 부족!
    }
}
```

### 왜 레귤레이터가 필요한가?

```
문제 상황:

    배터리 전압: 충전 시 4.2V → 방전 시 3.0V (변동!)
    어댑터 전압: 표기 12V이지만 실제 11.5~12.5V (변동!)
    USB 전압: 표기 5V이지만 실제 4.75~5.25V (변동!)

    ESP32 요구 전압: 3.3V (안정적이어야 함!)

해결:
    변동하는 전압 → [레귤레이터] → 안정적인 3.3V
    12V 전원     → [레귤레이터] → 5V 또는 3.3V
```

### 레귤레이터의 종류 개요

```
전압 레귤레이터
    │
    ├── 리니어 (Linear) 레귤레이터
    │   ├── 표준 레귤레이터 (78xx 시리즈)
    │   └── LDO (Low Drop-Out) 레귤레이터
    │
    └── 스위칭 (Switching) 레귤레이터
        ├── 벅 (Buck) - 강압 (전압 낮춤)
        ├── 부스트 (Boost) - 승압 (전압 높임)
        └── 벅-부스트 (Buck-Boost) - 강압+승압
```

---

## 2. LDO vs 스위칭 레귤레이터

### LDO (Low Drop-Out) 레귤레이터

```
    Vin ──┤ LDO ├── Vout
          │     │
          └──┬──┘
             │
            GND

    특징: 입력 전압을 "열로 변환"하여 전압을 낮춤
    (남는 에너지 = 열!)
```

| 특성 | 내용 |
|------|------|
| 원리 | 과잉 전압을 열로 소비 |
| 효율 | 낮음 (Vout/Vin × 100%) |
| 노이즈 | **매우 낮음** (깨끗한 출력!) |
| 외부 부품 | 커패시터 2개면 됨 (간단!) |
| 크기 | **작음** |
| 가격 | **저렴** |
| 발열 | 입출력 전압차 × 전류 = 발열 |
| 대표 부품 | AMS1117-3.3, LM1117 |

### 스위칭 레귤레이터

```
    Vin ──┤ 스위칭 ├── Vout
          │ 레귤    │
          │ 레이터  │
          └───┬────┘
              │
             GND
          (+ 인덕터, 커패시터, 다이오드 등 외부 부품 필요)

    특징: 고속 스위칭으로 에너지를 효율적으로 변환
    (스위칭 주파수: 수백 kHz ~ 수 MHz)
```

| 특성 | 내용 |
|------|------|
| 원리 | 고속 ON/OFF 스위칭 + 인덕터로 에너지 변환 |
| 효율 | **높음** (80~95%) |
| 노이즈 | 높음 (스위칭 노이즈 발생) |
| 외부 부품 | 인덕터, 커패시터, 다이오드 등 필요 (복잡) |
| 크기 | 크거나 (이산 부품) 보통 (모듈) |
| 가격 | 비쌈 |
| 발열 | **적음** (효율이 높으니까!) |
| 대표 부품 | LM2596, MP1584 (모듈) |

### 비교표

| 비교 항목 | LDO | 스위칭 |
|----------|:---:|:------:|
| 효율 | 낮음 (전압차 클수록 나쁨) | **높음 (80~95%)** |
| 노이즈 | **매우 낮음** | 높음 |
| 발열 | 높음 (전압차 × 전류) | **낮음** |
| 외부 부품 | **적음 (간단!)** | 많음 (복잡) |
| 가격 | **저렴** | 비쌈 |
| 승압 가능 | 불가 | **가능** |
| 크기 | **작음** | 보통~큼 |

### 어떤 것을 선택할까?

```
┌────────────────────────────────────────────────────┐
│                                                    │
│  LDO를 선택하는 경우:                                │
│  ├── 입출력 전압차가 작을 때 (5V → 3.3V)            │
│  ├── 전류가 작을 때 (500mA 이하)                     │
│  ├── 노이즈에 민감한 회로 (아날로그 센서, ADC)        │
│  ├── 간단한 설계가 필요할 때                         │
│  └── 비용을 줄이고 싶을 때                           │
│                                                    │
│  스위칭 레귤레이터를 선택하는 경우:                    │
│  ├── 입출력 전압차가 클 때 (12V → 3.3V, 24V → 5V)  │
│  ├── 전류가 클 때 (1A 이상)                          │
│  ├── 배터리 구동 (효율이 중요!)                      │
│  ├── 발열을 줄여야 할 때                             │
│  └── 승압이 필요할 때 (3.3V → 5V)                   │
│                                                    │
│  ※ 실무에서는 "스위칭 + LDO" 조합을 많이 사용:       │
│     12V → [스위칭] → 5V → [LDO] → 3.3V             │
│     (효율 높이면서 노이즈도 낮춤!)                    │
│                                                    │
└────────────────────────────────────────────────────┘
```

---

## 3. 대표적인 레귤레이터

### AMS1117-3.3 (5V → 3.3V LDO)

```
    핀 배치 (SOT-223 패키지, 정면):

    ┌──────────────────┐
    │                  │◄── 방열 탭 (Vout에 연결)
    │   AMS1117-3.3    │
    │                  │
    └──┬────┬────┬─────┘
       │    │    │
      GND  Vout  Vin

    또는 TO-252 패키지도 있음
```

| 사양 | 값 |
|------|-----|
| 입력 전압 | 4.5V ~ 12V |
| 출력 전압 | **3.3V** (고정) |
| 최대 출력 전류 | **1A** (방열 필요) |
| 드롭아웃 전압 | ~1.1V (1A 시) |
| 정밀도 | ±1.5% |
| 패키지 | SOT-223, TO-252 |
| 용도 | **ESP32 개발보드에 거의 필수!** |

```
AMS1117-3.3 기본 회로:

    5V ──┤ IN        OUT ├── 3.3V
         │  AMS1117      │
         │    -3.3       │
         └──────┬────────┘
                │
    [22μF]     GND      [22μF]
      │                    │
     GND                  GND

    ※ 입력 커패시터: 22μF (전해 또는 세라믹)
    ※ 출력 커패시터: 22μF (전해 또는 세라믹)
    ※ 데이터시트 권장값을 따르세요!
```

> **참고:** 대부분의 ESP32 개발보드(DevKit)에는 AMS1117-3.3이 이미 장착되어 있습니다.
> USB 5V → AMS1117 → 3.3V로 ESP32에 전원을 공급합니다.

### 7805 (12V → 5V 리니어 레귤레이터)

```
    핀 배치 (TO-220 패키지, 정면):

    ┌──────────────────┐
    │                  │◄── 방열 탭 (GND에 연결)
    │      7805        │
    │                  │
    └──┬────┬────┬─────┘
       │    │    │
      Vin  GND  Vout
```

| 사양 | 값 |
|------|-----|
| 입력 전압 | 7V ~ 25V |
| 출력 전압 | **5V** (고정) |
| 최대 출력 전류 | **1.5A** (히트싱크 필요!) |
| 드롭아웃 전압 | ~2V |
| 패키지 | TO-220 |
| 용도 | 12V → 5V 변환, 기본 전원 회로 |

```
7805 기본 회로:

    12V ──[7805]── 5V
            │
    [100nF] │ [100nF]  ← 세라믹 커패시터 (필수!)
      │    GND    │
     GND         GND

    ※ 입출력에 반드시 100nF 세라믹 커패시터!
    ※ 추가로 전해 커패시터(100~470μF)를 병렬로 달면 더 좋음
```

### 78xx 시리즈 (출력 전압별)

| 부품명 | 출력 전압 | 최소 입력 전압 |
|--------|:--------:|:------------:|
| 7805 | 5V | 7V |
| 7809 | 9V | 11V |
| 7812 | 12V | 14V |

### 스위칭 레귤레이터 모듈

```
LM2596 기반 벅 컨버터 모듈:

    ┌─────────────────────────────┐
    │  IN+ IN- │ │ OUT+ OUT-     │
    │  ○   ○   │ │  ○    ○      │
    │          │ │              │
    │   [인덕터] │              │
    │          │가│              │
    │  [LM2596]│변│  [LED]       │
    │          │저│              │
    │  [다이오드]│항│              │
    │          │ │              │
    └─────────────────────────────┘

    ※ 가변저항(트리머)로 출력 전압 조절 가능
    ※ 또는 고정 출력(3.3V, 5V) 모듈도 있음
```

| 사양 | 값 |
|------|-----|
| 입력 전압 | 4.5V ~ 40V |
| 출력 전압 | 1.25V ~ 37V (가변) |
| 최대 출력 전류 | 3A |
| 효율 | ~90% |
| 가격 | ~1,000원 (모듈) |

---

## 4. 입출력 전압차와 발열 문제

### LDO의 발열 계산

LDO 레귤레이터에서 발생하는 열은 간단하게 계산할 수 있습니다:

```
발열량(소비 전력) = (Vin - Vout) × Iout

예제 1: 5V → 3.3V, 200mA
    P = (5V - 3.3V) × 0.2A = 1.7V × 0.2A = 0.34W
    → 무난! (방열 없이 가능)

예제 2: 12V → 3.3V, 200mA
    P = (12V - 3.3V) × 0.2A = 8.7V × 0.2A = 1.74W
    → 뜨거워! (히트싱크 필요하거나 스위칭 권장)

예제 3: 12V → 5V, 1A (7805)
    P = (12V - 5V) × 1A = 7V × 1A = 7W
    → 매우 뜨거워! (큰 히트싱크 필수 또는 스위칭 사용!)

예제 4: 24V → 3.3V, 500mA
    P = (24V - 3.3V) × 0.5A = 20.7V × 0.5A = 10.35W
    → 불가능! (LDO 사용 불가, 반드시 스위칭 사용!)
```

### 효율 비교

```
예: 12V → 3.3V, 500mA

LDO:
    소비 전력 = 12V × 0.5A = 6W (입력)
    유용 전력 = 3.3V × 0.5A = 1.65W (출력)
    효율 = 1.65 / 6 = 27.5% → 나머지 72.5%가 열로!

스위칭 (효율 90%):
    소비 전력 = 1.65W / 0.9 = 1.83W (입력)
    손실 = 1.83 - 1.65 = 0.18W → 적은 발열!
```

### 발열 판단 기준

```
┌────────────────────────────────────────────────┐
│         LDO 발열 판단 기준                       │
├────────────────────────────────────────────────┤
│                                                │
│  P < 0.5W   → 방열 불필요, LDO OK              │
│  P 0.5~1W   → 작은 방열판 또는 넓은 PCB 패턴    │
│  P 1~2W     → 방열판 필요                       │
│  P > 2W     → LDO 부적합! 스위칭 사용!          │
│                                                │
│  ※ SOT-223 패키지 기준                          │
│  ※ TO-220 패키지는 좀 더 여유 있음               │
│                                                │
└────────────────────────────────────────────────┘
```

---

## 5. 드롭아웃 전압 개념

### 드롭아웃 전압이란?

레귤레이터가 정상적으로 동작하기 위해 필요한 **최소한의 입출력 전압차**입니다.

```
드롭아웃 전압 = Vin(최소) - Vout

    Vin ───┤ 레귤레이터 ├─── Vout
           │           │
    입력 전압이 "Vout + 드롭아웃" 이상이어야 정상 동작!
```

### 예시

```
AMS1117-3.3:
    드롭아웃: ~1.1V (1A 시), ~0.8V (소전류)
    필요 최소 입력: 3.3V + 1.1V = 4.4V

    5V 입력 → 5.0 - 3.3 = 1.7V 여유 → 정상 동작! ✓
    4.0V 입력 → 4.0 - 3.3 = 0.7V < 1.1V → 출력 전압 부족! ✗

7805:
    드롭아웃: ~2V
    필요 최소 입력: 5V + 2V = 7V

    12V 입력 → 정상 동작! ✓
    6V 입력 → 출력 전압 부족! ✗
```

### LDO vs 일반 리니어 레귤레이터

```
"LDO"의 의미:
LDO = Low Drop-Out = 낮은 드롭아웃

일반 리니어 (7805 등):    드롭아웃 ~2V
LDO (AMS1117 등):        드롭아웃 ~1.1V
초저 드롭아웃 LDO:         드롭아웃 ~0.1~0.3V

※ 배터리 구동 시 드롭아웃이 낮을수록 유리!
   (배터리가 더 방전될 때까지 동작 가능)
```

### 드롭아웃 미달 시 증상

```
입력 전압이 부족하면:

    ┌──────────────────────────────────────┐
    │                                      │
    │  출력 전압이 3.3V보다 낮아짐            │
    │  ↓                                   │
    │  ESP32가 불안정하게 동작               │
    │  ↓                                   │
    │  WiFi 끊김, 재부팅 반복               │
    │  ↓                                   │
    │  센서 값이 부정확                      │
    │  ↓                                   │
    │  최악의 경우: 데이터 손실, 플래시 손상   │
    │                                      │
    │  진단: 멀티미터로 레귤레이터 출력 측정!  │
    │  3.3V ± 5% (3.14~3.47V)이면 정상      │
    │                                      │
    └──────────────────────────────────────┘
```

---

## 6. 입출력 커패시터의 역할

### 왜 커패시터가 필요한가?

레귤레이터의 입출력에 커패시터를 달지 않으면:
- 출력이 불안정해질 수 있음
- 발진(oscillation)이 발생할 수 있음
- 과도 응답(급격한 부하 변화)에 취약

```
레귤레이터 회로의 커패시터 배치:

    입력 커패시터        레귤레이터        출력 커패시터
        │              │        │              │
    Vin ┤  [Cin]   IN  ┤        ├ OUT  [Cout]  ├ Vout
        │    │         │        │        │     │
       GND  GND       GND     GND      GND   GND
```

### 입력 커패시터 (Cin)

```
역할:
┌────────────────────────────────────────────────┐
│                                                │
│  1. 입력 전원의 노이즈/리플 흡수                  │
│  2. 순간적인 전류 수요 보충                       │
│  3. 긴 배선에 의한 전압 강하 보상                  │
│                                                │
│  권장값:                                        │
│  - 세라믹: 100nF ~ 1μF (필수!)                  │
│  - 전해: 10μF ~ 100μF (추가하면 더 좋음)         │
│                                                │
│  ※ 레귤레이터와 최대한 가까이 배치!               │
│                                                │
└────────────────────────────────────────────────┘
```

### 출력 커패시터 (Cout)

```
역할:
┌────────────────────────────────────────────────┐
│                                                │
│  1. 출력 전압 안정화                              │
│  2. 부하 변동 시 과도 응답 개선                    │
│  3. LDO 안정성 확보 (발진 방지)                   │
│                                                │
│  권장값:                                        │
│  - 세라믹: 100nF ~ 1μF (필수!)                  │
│  - 전해: 22μF ~ 100μF (데이터시트 확인!)         │
│                                                │
│  주의: LDO에 따라 출력 커패시터의 ESR 범위가      │
│  정해져 있음! 데이터시트를 반드시 확인!             │
│                                                │
└────────────────────────────────────────────────┘
```

### 완전한 레귤레이터 회로

```
    12V     [Cin1]    [Cin2]           [Cout1]  [Cout2]    3.3V
    ──┬──── 100μF ──── 100nF ──┬──┤ LDO ├──┬── 22μF ─── 100nF ──┬──
      │     전해     세라믹    │          │   전해    세라믹    │
      │      │         │      │          │    │        │       │
     GND    GND       GND    GND        GND  GND     GND     GND

    전해 커패시터: 저주파 리플, 큰 에너지 저장
    세라믹 커패시터: 고주파 노이즈 제거
    → 두 종류를 함께 사용하면 최상의 결과!
```

---

## 7. 실습: ESP32 전원 회로 설계

### 실습 1: AMS1117-3.3으로 5V → 3.3V 변환

```
    USB 5V
     │
     ├──[100μF/10V]──┐
     │   (전해)       │
     ├──[100nF]──────┤
     │               │
     ├───── IN ──────┤
     │               │
     │  AMS1117-3.3  │
     │               │
     ├───── GND ─────┤
     │               │
     │               ├──── OUT ──┬── 3.3V (ESP32)
     │               │           │
     │               │     [22μF/10V]
     │               │      (전해) │
     │               │           │
     │               │     [100nF]│
     │               │        │  │
    GND ─────────────┴────────┴──┘

    입력: USB 5V
    출력: 안정적인 3.3V
    최대 전류: 1A (방열 필요 시)

    발열: P = (5 - 3.3) × I
    I = 200mA → P = 0.34W (무난)
    I = 500mA → P = 0.85W (약간 따뜻)
    I = 1A → P = 1.7W (히트싱크 필요!)
```

### 실습 2: 7805로 12V → 5V 변환

```
    12V 어댑터
     │
     ├──[470μF/25V]──┐
     │   (전해)       │
     ├──[100nF]──────┤
     │               │
     ├─── IN ────────┤
     │               │
     │    7805       │
     │               │
     ├─── GND ───────┤
     │               │
     │    OUT ───────┬┤── 5V 출력
     │              │ │
     │         [100μF/10V]
     │          (전해) │
     │              │ │
     │         [100nF]│
     │           │   │
    GND ─────────┴───┘

    입력: 12V DC
    출력: 5V DC
    최대 전류: 1.5A (히트싱크 필수!)

    발열: P = (12 - 5) × 1A = 7W → 큰 히트싱크 필요!
```

### 실습 3: 12V → 5V → 3.3V 2단계 변환

```
12V 전원에서 ESP32 + 5V 부하 + 3.3V 부하를 동시에 공급:

    12V ──┬──[LM2596 모듈]──┬── 5V ──┬── 릴레이 모듈 (5V)
          │  (스위칭, 효율적) │        │
         GND               GND       ├──[AMS1117-3.3]──┬── 3.3V
                                     │  (LDO, 깨끗한)   │
                                    GND                 ├── ESP32
                                                        │
                                                        ├── 센서들
                                                        │
                                                       GND

    1단계: 12V → 5V (스위칭) → 효율 높고, 발열 적음
    2단계: 5V → 3.3V (LDO) → 노이즈 낮고, 깨끗한 전원

    이 조합이 실무에서 가장 많이 사용됩니다!
```

### 실습 4: 배터리 전원 회로

```
리튬 배터리(18650) → ESP32 전원 공급:

    18650 배터리                  LDO          ESP32
    (3.0~4.2V)                               (3.3V)
        │                                      │
        ├──▶|──┬──[Cin]──┤ LDO  ├──[Cout]──┬──┤
        │ 1N5819│         │(저드롭)│         │  │
        │      │         │       │         │  │
       GND    GND       GND    GND       GND GND

    주의:
    - 배터리 전압 범위: 3.0V(방전) ~ 4.2V(충전)
    - 드롭아웃이 낮은 LDO 필요! (0.2V 이하)
    - 예: HT7333, ME6211C33 등 (드롭아웃 ~0.1V)
    - 일반 AMS1117(드롭아웃 1.1V)은 부적합!
      (3.0V 배터리에서 3.0-1.1=1.9V → ESP32 동작 불가!)
```

### 전원 설계 체크리스트

```
ESP32 전원 회로 설계 시 확인할 것:

[ ] 입력 전압 범위 확인 (최소~최대)
[ ] 필요 출력 전압 확인 (3.3V, 5V 등)
[ ] 최대 출력 전류 계산 (모든 부하 합산)
[ ] 레귤레이터 선택 (LDO or 스위칭)
[ ] 드롭아웃 전압 확인 (입력이 충분한지)
[ ] 발열 계산 (P = (Vin-Vout) × Iout)
[ ] 입출력 커패시터 배치 (데이터시트 참고)
[ ] 역접속 보호 다이오드 추가
[ ] 실측: 멀티미터로 출력 전압 확인
[ ] WiFi 동작 시 전압 안정성 확인
```

---

## 핵심 정리

```
┌─────────────────────────────────────────────────────────┐
│                 레귤레이터 핵심 정리                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 레귤레이터 = 불안정한 전압을 일정하게 만드는 부품      │
│                                                         │
│  2. LDO vs 스위칭:                                      │
│     - LDO: 간단, 저렴, 깨끗, but 발열 (전압차 작을 때)   │
│     - 스위칭: 효율적, but 복잡, 노이즈 (전압차 클 때)     │
│                                                         │
│  3. 대표 레귤레이터:                                     │
│     - AMS1117-3.3: 5V → 3.3V (ESP32 보드에 내장!)       │
│     - 7805: 12V → 5V (고전력은 스위칭 권장)              │
│     - LM2596 모듈: 범용 스위칭 (높은 효율)               │
│                                                         │
│  4. 발열 = (Vin - Vout) × Iout                          │
│     - 2W 이상이면 LDO 부적합 → 스위칭 사용!              │
│                                                         │
│  5. 드롭아웃 전압:                                       │
│     - 입력이 "Vout + 드롭아웃" 이상이어야 정상 동작        │
│     - 배터리 구동 시 저드롭아웃 LDO 선택!                 │
│                                                         │
│  6. 커패시터 필수!                                       │
│     - 입력: 전해 + 세라믹                                │
│     - 출력: 전해 + 세라믹                                │
│     - 레귤레이터와 최대한 가까이 배치!                     │
│                                                         │
│  7. 실무 조합: 12V → [스위칭] → 5V → [LDO] → 3.3V       │
│     (효율과 노이즈 모두 잡는 최적의 조합)                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

> **다음 학습:** [08. 데이터시트 읽는 법](08-datasheet-reading.md)에서 부품의 정확한 사양을 확인하는 방법을 배워봅시다!
