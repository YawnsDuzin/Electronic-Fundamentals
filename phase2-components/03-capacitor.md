# 03. 커패시터 (콘덴서, Capacitor)

## 목차
1. [커패시터란?](#1-커패시터란)
2. [커패시터의 역할](#2-커패시터의-역할)
3. [커패시터의 종류](#3-커패시터의-종류)
4. [단위와 표기법](#4-단위와-표기법)
5. [용도별 사용법](#5-용도별-사용법)
6. [전해 커패시터 극성 주의사항](#6-전해-커패시터-극성-주의사항)
7. [실습: ESP32 회로에서 커패시터 사용](#7-실습-esp32-회로에서-커패시터-사용)
8. [핵심 정리](#핵심-정리)

---

## 1. 커패시터란?

커패시터(Capacitor, 일본식으로 "콘덴서"라고도 함)는 **전하(에너지)를 저장**하는 부품입니다.
두 개의 금속판 사이에 절연체를 넣은 구조입니다.

```
소프트웨어 비유:
커패시터는 "버퍼(Buffer)" 또는 "캐시(Cache)"와 같습니다.
- 데이터(전하)를 일시적으로 저장했다가 필요할 때 내보냅니다.
- 입력의 급격한 변화(노이즈)를 흡수하여 부드럽게 만듭니다.
- 메시지 큐(Message Queue)처럼 과부하를 완충합니다.
```

### 기본 원리

```
충전 (Charging):                방전 (Discharging):

    V+ ─────┤├───── GND         부하(Load)
          충전 중                    │
    전류 →→→→→→→→               ┤├──┤──┤├
                                커패시터  부하
    금속판에 전하가 쌓임          전하가 방출됨
    (+) ═══╪═══ (-)             (+) ═══╪═══ (-)
        절연체                      절연체
```

---

## 2. 커패시터의 역할

### 2-1. 에너지 저장 (Energy Storage)

전하를 충전했다가 필요할 때 방전합니다.

```
전원이 순간적으로 부족할 때:

    전원 ──┬── [커패시터] ──┬── ESP32
           │               │
           │  전원 안정 시:  │
           │  커패시터 충전   │
           │               │
           │  전원 부족 시:  │
           │  커패시터 방전   │ ← 순간적으로 전원을 보충!
           │               │
          GND             GND
```

### 2-2. 노이즈 필터링 (Noise Filtering)

전원 라인의 고주파 노이즈를 흡수합니다.

```
노이즈가 있는 전원:              커패시터 추가 후:

    ~~~╱╲╱╲╱╲~~~                ─────────────────
    ↑ 노이즈가 심함              ↑ 깨끗한 전원!

    커패시터는 고주파 노이즈를 GND로 흘려보냅니다.
    (고주파 = 커패시터를 쉽게 통과)
```

### 2-3. 신호 결합/분리 (Coupling/Decoupling)

DC 성분은 차단하고 AC 성분만 통과시킵니다.

```
DC 차단, AC 통과:

    DC + AC 신호 ──┤├── AC 신호만 통과
                 커패시터

    이것을 "커플링 커패시터"라고 합니다.
```

---

## 3. 커패시터의 종류

### 3-1. 세라믹 커패시터 (Ceramic Capacitor) - 무극성

```
    외형:                    회로도 기호:

    ┌──────┐                    │
    │ 104  │ ← 용량 표기         ┤├
    │      │                    │
    └──┬┬──┘
       ││                  극성 없음!
       ││                  어느 방향이든 OK
```

| 특징 | 내용 |
|------|------|
| 극성 | **없음** (어느 방향이든 연결 가능) |
| 용량 범위 | 1pF ~ 100μF (보통 100pF ~ 100nF) |
| 장점 | 소형, 저렴, 고주파 특성 우수, 극성 없음 |
| 단점 | 대용량 불가 (보통 1μF 이하) |
| 주 용도 | 디커플링, 고주파 노이즈 제거 |
| 대표적 값 | **100nF (0.1μF)** = 가장 많이 사용! |

### 3-2. 전해 커패시터 (Electrolytic Capacitor) - 유극성

```
    외형:                          회로도 기호:

    ┌────────────┐                     │
    │ (-) 표시   │                    ─┤├─
    │ 줄무늬     │ ← 음극 표시         +│ -
    │ ▼▼▼▼▼▼    │                     │
    │            │
    │ 100μF 25V │ ← 용량, 내압 표기   극성이 있다!
    │            │                    반드시 (+)(-)
    └──┬────┬───┘                    방향 확인!
       │    │
     (+)  (-)
    긴다리  짧은다리
```

| 특징 | 내용 |
|------|------|
| 극성 | **있음!** (반드시 +/- 확인) |
| 용량 범위 | 0.1μF ~ 수만 μF |
| 장점 | 대용량 가능, 저렴 |
| 단점 | 극성 주의, 고주파 특성 나쁨, 수명 제한 |
| 주 용도 | 전원 필터링, 대용량 에너지 저장 |
| 대표적 값 | 10μF, 100μF, 470μF, 1000μF |

### 3-3. 탄탈 커패시터 (Tantalum Capacitor) - 유극성

```
    외형 (SMD):

    ┌──────────┐
    │  줄 표시  │ ← 양극(+) 표시
    │  ▶       │
    └──────────┘

    ※ 전해 커패시터보다 안정적이지만 비쌈
    ※ 극성 반대로 연결하면 불꽃 + 연기!
```

### 종류별 비교표

| 특성 | 세라믹 | 전해 | 탄탈 |
|------|:------:|:----:|:----:|
| 극성 | 없음 | 있음 | 있음 |
| 용량 범위 | pF~μF | μF~mF | μF |
| 고주파 특성 | 우수 | 나쁨 | 보통 |
| 크기 | 소형 | 대형 | 중형 |
| 가격 | 저렴 | 저렴 | 비쌈 |
| 수명 | 매우 긴 | 제한적 | 긴 |
| ESP32 용도 | 디커플링 | 전원 필터 | 정밀 회로 |

---

## 4. 단위와 표기법

### 커패시턴스 단위

커패시턴스(정전용량)의 기본 단위는 **패럿(Farad, F)**입니다.
1F은 엄청나게 큰 값이라, 실제로는 작은 단위를 사용합니다.

| 단위 | 기호 | 패럿(F) 환산 | 예시 |
|------|:----:|:----------:|------|
| 마이크로패럿 | μF | 10⁻⁶ F | 1μF, 10μF, 100μF, 1000μF |
| 나노패럿 | nF | 10⁻⁹ F | 1nF, 10nF, 100nF |
| 피코패럿 | pF | 10⁻¹² F | 1pF, 10pF, 100pF, 1000pF |

### 단위 변환

```
1μF   = 1,000nF = 1,000,000pF
1nF   = 1,000pF = 0.001μF
100nF = 0.1μF   = 100,000pF

자주 헷갈리는 변환:
0.1μF  = 100nF  = 100,000pF
0.01μF = 10nF   = 10,000pF
0.001μF = 1nF   = 1,000pF
```

### 세라믹 커패시터 표기법 (3자리 코드)

세라믹 커패시터에는 **3자리 숫자**가 적혀 있습니다.

```
읽는 방법:
앞 두 자리 = 유효 숫자
마지막 자리 = 10의 거듭제곱 (pF 단위)

예: "104"
    10 × 10⁴ pF = 100,000pF = 100nF = 0.1μF
```

### 자주 보는 세라믹 커패시터 코드

| 표기 | 계산 | pF | nF | μF |
|:----:|------|---:|---:|---:|
| 101 | 10 × 10¹ | 100pF | 0.1nF | - |
| 102 | 10 × 10² | 1,000pF | 1nF | 0.001μF |
| 103 | 10 × 10³ | 10,000pF | 10nF | 0.01μF |
| **104** | **10 × 10⁴** | **100,000pF** | **100nF** | **0.1μF** |
| 105 | 10 × 10⁵ | 1,000,000pF | 1,000nF | 1μF |
| 221 | 22 × 10¹ | 220pF | 0.22nF | - |
| 471 | 47 × 10¹ | 470pF | 0.47nF | - |
| 472 | 47 × 10² | 4,700pF | 4.7nF | 0.0047μF |
| 473 | 47 × 10³ | 47,000pF | 47nF | 0.047μF |

> **가장 많이 쓰는 것:** "104" = 100nF(0.1μF) 세라믹 커패시터
> ESP32 회로에서 디커플링용으로 거의 필수입니다!

---

## 5. 용도별 사용법

### 5-1. 디커플링 커패시터 (Decoupling Capacitor) - 100nF

**가장 중요한 용도!** IC(칩) 바로 옆에 배치하여 순간적인 전류 수요를 보충합니다.

```
    VCC ──────┬──────── IC의 VCC 핀
              │
           [100nF]    ← 디커플링 커패시터
              │          (IC와 최대한 가까이!)
    GND ──────┴──────── IC의 GND 핀
```

```
왜 필요한가?

ESP32가 갑자기 많은 전류를 소비할 때 (예: WiFi 전송):
- 전원선이 길면 전압이 순간적으로 떨어짐 (전압 강하)
- 디커플링 커패시터가 저장해둔 전하를 즉시 공급
- 전압 안정 유지!

소프트웨어 비유:
캐시 메모리(L1 Cache)와 같은 역할.
메인 메모리(전원)에서 데이터를 가져오기 전에,
가까운 캐시(커패시터)에서 먼저 공급.
```

> **규칙:** 모든 IC의 VCC-GND 사이에 **100nF 세라믹 커패시터**를 달아주세요!
> ESP32 보드에는 이미 포함되어 있지만, 외부 IC를 추가할 때는 반드시 넣어야 합니다.

### 5-2. 전원 필터 커패시터 (Bulk Capacitor) - 100μF ~ 1000μF

전원 입력부에 큰 용량의 커패시터를 배치하여 전체적인 전원 안정성을 높입니다.

```
    외부 전원        전해 커패시터        세라믹         ESP32
    (5V/12V)         (벌크)          (디커플링)
       │                │                │              │
       ├────┬──────┬────┤                │              │
       │    │      │    │                │              │
       │ [100μF]   │ [100nF]             │              │
       │    │      │    │                │              │
       └────┴──────┴────┘                │              │
            GND                         GND            GND

    ※ 전해 커패시터(벌크) = 저주파 노이즈 흡수, 전원 안정화
    ※ 세라믹 커패시터(디커플링) = 고주파 노이즈 흡수
    ※ 두 종류를 함께 사용하는 것이 이상적!
```

### 5-3. 디바운싱 (Debouncing)

버튼을 누를 때 발생하는 기계적 바운싱(떨림)을 커패시터로 흡수합니다.

```
버튼의 바운싱 현상:

    전압
     │
 3.3V├── ┌┐ ┌┐ ┌──────────────
     │   ││ ││ │
   0V├───┘└─┘└─┘
     └──────────────────────→ 시간
         ↑
      바운싱 구간
      (1~10ms)
      여러 번 ON/OFF 반복!

커패시터 추가 후:

    전압
     │
 3.3V├── ╱──────────────────
     │  ╱
   0V├─╱
     └──────────────────────→ 시간
         ↑
      부드럽게 전환
      (바운싱 흡수!)
```

#### 하드웨어 디바운싱 회로

```
    3.3V
     │
    [10kΩ]  ← 풀업 저항
     │
     ├───────── ESP32 GPIO (입력)
     │
    [100nF] ← 디바운싱 커패시터
     │
   [버튼]
     │
    GND
```

> **참고:** 소프트웨어 디바운싱(코드에서 20ms 딜레이)도 가능하지만,
> 하드웨어 디바운싱이 더 확실합니다. 둘을 함께 사용하면 가장 좋습니다.

### 5-4. 타이밍 회로 (RC 회로)

저항(R)과 커패시터(C)를 조합하면 시간 지연 회로를 만들 수 있습니다.

```
    RC 시정수 (Time Constant):

    τ = R × C

    예: R = 10kΩ, C = 100μF
    τ = 10,000 × 0.0001 = 1초

    충전 시간:
    - 1τ: 63.2% 충전
    - 2τ: 86.5% 충전
    - 3τ: 95.0% 충전
    - 5τ: 99.3% 충전 (사실상 완충)
```

---

## 6. 전해 커패시터 극성 주의사항

### 극성 확인 방법

```
전해 커패시터의 극성 표시:

    줄무늬(밴드) 표시     다리 길이
    ┌─────────────┐
    │ (-) ▼▼▼▼▼  │      긴 다리 = (+) 양극
    │     ▼▼▼▼▼  │      짧은 다리 = (-) 음극
    │     ▼▼▼▼▼  │
    │             │
    │ 100μF 25V  │
    │             │
    └──┬─────┬───┘
       │     │
     (+)   (-)
   긴다리  짧은다리

    ※ 줄무늬/마이너스(-) 기호가 있는 쪽이 음극(-)!
    ※ 이것이 저항이나 세라믹 커패시터와 가장 큰 차이점!
```

### 역극성 연결의 위험

```
┌──────────────────────────────────────────────────┐
│                                                  │
│   ⚠ 경고: 전해 커패시터를 역으로 연결하면!         │
│                                                  │
│   1. 내부 전해액이 가열됨                          │
│   2. 가스가 발생함                                │
│   3. 커패시터가 부풀어 오름                        │
│   4. 최악의 경우: 폭발! (파열!)                    │
│                                                  │
│   폭발 시 전해액이 튈 수 있으므로                   │
│   보안경 착용을 권장합니다.                         │
│                                                  │
│   ※ 내압(정격 전압) 초과 시에도 같은 현상 발생!     │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 올바른 연결 vs 잘못된 연결

```
올바른 연결 (O):                잘못된 연결 (X):

    VCC (+)                      VCC (+)
     │                            │
    (+)                          (-)  ← 극성 반대!
   [100μF]                     [100μF]
    (-)                          (+)
     │                            │
    GND (-)                      GND (-)

    정상 동작!                    폭발 위험!
```

### 내압(정격 전압) 확인

```
커패시터 표기: "100μF 25V"

    100μF = 정전용량
    25V   = 내압 (이 전압 이하에서 사용해야 함!)

    안전 규칙:
    실제 사용 전압은 내압의 60~80% 이하로!

    예: 5V 회로 → 최소 10V 내압 커패시터 사용
        12V 회로 → 최소 25V 내압 커패시터 사용
```

---

## 7. 실습: ESP32 회로에서 커패시터 사용

### 실습 1: 전원 안정화

ESP32에 외부 전원을 공급할 때 커패시터를 추가하는 기본 회로입니다.

```
    외부 전원 (5V)
        │
        ├──[100μF/10V]──┐    ← 전해 커패시터 (벌크)
        │   (전해,극성주의) │
        │                │
        ├──[100nF]───────┤    ← 세라믹 커패시터 (디커플링)
        │                │
        │                │
        ├────────────────┤
        │                │
     ESP32 VIN        ESP32 GND
```

### 실습 2: 버튼 디바운싱

```
    3.3V
     │
    [10kΩ]
     │
     ├──────┬───── GPIO 4 (ESP32)
     │      │
     │   [100nF]
     │      │
   [버튼]   │
     │      │
     └──────┘
     │
    GND
```

#### 소프트웨어 + 하드웨어 디바운싱 코드

```cpp
const int BUTTON_PIN = 4;
const unsigned long DEBOUNCE_DELAY = 50;  // 50ms

unsigned long lastDebounceTime = 0;
int lastButtonState = HIGH;
int buttonState = HIGH;

void setup() {
    pinMode(BUTTON_PIN, INPUT);  // 외부 풀업 사용
    Serial.begin(115200);
}

void loop() {
    int reading = digitalRead(BUTTON_PIN);

    if (reading != lastButtonState) {
        lastDebounceTime = millis();
    }

    if ((millis() - lastDebounceTime) > DEBOUNCE_DELAY) {
        if (reading != buttonState) {
            buttonState = reading;
            if (buttonState == LOW) {
                Serial.println("버튼 눌림!");
            }
        }
    }

    lastButtonState = reading;
}
```

### 실습 3: RC 시정수 체험

커패시터의 충방전을 ADC로 읽어보는 실습입니다.

```
    3.3V
     │
    [10kΩ]
     │
     ├───── GPIO 34 (ADC, ESP32)
     │
   [100μF]
     │
    GND

    τ = R × C = 10kΩ × 100μF = 1초
```

```cpp
const int ADC_PIN = 34;
const int CHARGE_PIN = 25;  // 충전 제어용

void setup() {
    Serial.begin(115200);
    pinMode(ADC_PIN, INPUT);
    pinMode(CHARGE_PIN, OUTPUT);
    digitalWrite(CHARGE_PIN, LOW);  // 초기: 방전
}

void loop() {
    Serial.println("충전 시작!");
    digitalWrite(CHARGE_PIN, HIGH);

    // 5초간 ADC 값 읽기 (충전 곡선 관찰)
    for (int i = 0; i < 50; i++) {
        int adcValue = analogRead(ADC_PIN);
        float voltage = adcValue * 3.3 / 4095.0;
        Serial.print("시간: ");
        Serial.print(i * 100);
        Serial.print("ms, 전압: ");
        Serial.print(voltage, 2);
        Serial.println("V");
        delay(100);
    }

    Serial.println("방전 시작!");
    digitalWrite(CHARGE_PIN, LOW);
    delay(5000);  // 5초 방전 대기
}
```

---

## 핵심 정리

```
┌─────────────────────────────────────────────────────────┐
│                  커패시터 핵심 정리                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 커패시터 = 전하(에너지) 저장 부품 (버퍼/캐시 역할)     │
│                                                         │
│  2. 두 가지 주요 종류:                                    │
│     - 세라믹: 무극성, 소용량, 고주파 특성 우수              │
│     - 전해:  유극성!, 대용량, 저주파 전원 필터             │
│                                                         │
│  3. 단위: pF → nF (×1000) → μF (×1000)                 │
│                                                         │
│  4. 세라믹 3자리 코드: "104" = 100nF = 0.1μF             │
│                                                         │
│  5. 핵심 용도:                                           │
│     - 디커플링: IC 옆에 100nF 세라믹 (필수!)              │
│     - 전원 필터: 전원부에 100μF~1000μF 전해               │
│     - 디바운싱: 버튼 옆에 100nF 세라믹                    │
│                                                         │
│  6. 전해 커패시터 주의사항:                                │
│     - 극성 반대 → 폭발 위험!                              │
│     - 줄무늬 쪽 = 음극(-), 긴 다리 = 양극(+)              │
│     - 내압(정격 전압) 반드시 확인!                         │
│                                                         │
│  7. 세라믹 + 전해를 함께 사용하면 가장 효과적               │
│     (각각 고주파/저주파 노이즈 담당)                       │
│                                                         │
│  8. RC 시정수: τ = R × C (충전 시간 계산)                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

> **다음 학습:** [04. 다이오드](04-diode.md)에서 전류의 방향을 제어하는 방법을 배워봅시다!
