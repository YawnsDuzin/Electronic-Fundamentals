# 04. 회로 보호 (Circuit Protection)

## 개요

아무리 잘 설계된 회로라도 **예기치 않은 상황**에서 고장이 날 수 있습니다.
역극성 연결, 과전류, 서지(과전압), 정전기 등 다양한 위협으로부터 회로를
보호하는 방법을 알아봅시다.

```
    회로가 직면하는 위협들:

    ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐
    │ 역극성   │   │ 과전류   │   │ 과전압   │   │ 정전기   │
    │ (+ - 바꿈)│   │ (단락)   │   │ (서지)   │   │ (ESD)    │
    └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘
         │              │              │              │
         ▼              ▼              ▼              ▼
    ┌─────────────────────────────────────────────────────┐
    │                    보호 회로                          │
    │  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐    │
    │  │다이오드 │  │ 퓨즈   │  │ TVS    │  │ ESD    │    │
    │  │/MOSFET │  │/PTC    │  │다이오드 │  │보호소자│    │
    │  └────────┘  └────────┘  └────────┘  └────────┘    │
    └────────────────────┬────────────────────────────────┘
                         │
                         ▼
    ┌─────────────────────────────────────────────────────┐
    │               안전한 회로 동작                        │
    └─────────────────────────────────────────────────────┘
```

---

## 1. 역극성 보호 (Reverse Polarity Protection)

### 1.1 역극성이란?

**역극성(Reverse Polarity)**은 전원의 +와 -를 반대로 연결하는 것입니다.
배터리를 뒤집어 넣거나, DC잭의 극성이 다른 어댑터를 꽂을 때 발생합니다.

```
    ⚠️  역극성 연결의 결과:
    ─────────────────────────────────────────
    - IC(칩) 내부 보호 다이오드 파괴
    - 커패시터 폭발 (전해 커패시터)
    - 전체 회로 영구 손상
    - 최악의 경우 화재 발생
    ─────────────────────────────────────────
```

### 1.2 다이오드 방식 (가장 간단)

전원 라인에 다이오드를 직렬로 연결하여, 역방향 전류를 차단합니다.

```
    다이오드 역극성 보호 회로:

    정상 연결 시 (+ → -):
    V_IN(+) ──▶│── 전류 흐름 ──▶ 회로 ── V_IN(-)
               다이오드                     (정상 동작)
               (순방향)

    역극성 연결 시 (- → +):
    V_IN(-) ──│◀── 전류 차단! ── 회로 ── V_IN(+)
               다이오드                     (회로 보호됨!)
               (역방향)

    회로도:
                D1
    V_IN ────▶│──────┬────── V_CC (회로 전원)
              1N5819 │
              (쇼트키) │
                     [C1: 100μF]
                      │
    GND ──────────────┴────── GND
```

#### 다이오드 방식의 장단점

| 장점 | 단점 |
|------|------|
| 매우 간단 (부품 1개) | 순방향 전압 강하 (V_F) |
| 저렴 | 발열 (P = V_F × I) |
| 신뢰성 높음 | 효율 저하 |

#### 순방향 전압 강하 비교

| 다이오드 종류 | 순방향 전압 (V_F) | 1A 시 발열 |
|-------------|-------------------|-----------|
| 1N4001 (실리콘) | ~0.7V | 0.7W |
| 1N5819 (쇼트키) | ~0.3V | 0.3W |
| SS34 (쇼트키) | ~0.5V | 0.5W |

> **팁**: 쇼트키 다이오드(1N5819, SS34)를 사용하면 전압 강하를 줄일 수 있습니다.

### 1.3 P-MOSFET 방식 (고효율, 추천)

P채널 MOSFET을 사용하면 **전압 강하가 거의 없는** 역극성 보호가 가능합니다.

```
    P-MOSFET 역극성 보호 회로:

    V_IN ────┬──── S(소스)──D(드레인) ────┬──── V_CC
             │         Q1 (P-MOSFET)      │
             │         │                  │
             │     G(게이트)              [회로]
             │         │                  │
             ├── [R1: 100kΩ] ─┘          │
             │                            │
    GND ─────┴────────────────────────────┴──── GND

    상세 회로:

             S         D
    V_IN ───┤  P-FET  ├──── V_CC (회로 전원)
             │         │
             G         │
             │         │
            ┌┴┐       [C1]
     R1     │ │100kΩ   │
            └┬┘        │
             │         │
    GND ─────┴─────────┴──── GND

    동작 원리:
    ─────────────────────────────────────────
    정상 연결: 게이트가 GND(LOW) → P-FET ON → 전류 통과
              V_DS(on) = I × R_DS(on) ≈ 수십 mV (거의 무손실!)

    역극성:   게이트가 V_IN보다 높음 → P-FET OFF → 전류 차단
              바디 다이오드도 역방향 → 완벽 차단!
    ─────────────────────────────────────────
```

#### P-MOSFET 방식 vs 다이오드 방식 비교

| 특성 | 다이오드 방식 | P-MOSFET 방식 |
|------|-------------|---------------|
| 전압 강하 | 0.3~0.7V | 수십 mV (거의 없음) |
| 발열 | 있음 | 거의 없음 |
| 부품 수 | 1개 | 2개 (MOSFET + 저항) |
| 비용 | 50~100원 | 200~500원 |
| 복잡도 | 매우 쉬움 | 약간 복잡 |
| **추천 사용처** | **취미 프로젝트** | **배터리 구동, 고전류** |

#### 추천 P-MOSFET 부품

| 부품 | V_DS (max) | R_DS(on) | I_D (max) | 패키지 |
|------|-----------|----------|----------|--------|
| SI2301 | -20V | 0.11Ω | -2.8A | SOT-23 |
| AO3401 | -30V | 0.065Ω | -4A | SOT-23 |
| IRF9540 | -100V | 0.2Ω | -23A | TO-220 |
| FQP27P06 | -60V | 0.07Ω | -27A | TO-220 |

---

## 2. 퓨즈: 과전류 보호 (Overcurrent Protection)

### 2.1 과전류란?

**과전류(Overcurrent)**는 회로에 설계된 것보다 많은 전류가 흐르는 상황입니다.
원인은 주로 **단락(Short Circuit)** 또는 **부품 고장**입니다.

```
    과전류의 위험:
    ─────────────────────────────────────────
    - 전선 과열 → 피복 녹음 → 화재
    - 부품 파괴 (IC, 저항 등)
    - 배터리 과열 → 폭발 위험 (리튬 배터리)
    - 전원 장치(어댑터) 고장
    ─────────────────────────────────────────
```

### 2.2 일반 퓨즈 (One-shot Fuse)

과전류가 흐르면 내부 금속선이 녹아서 끊어지는 가장 기본적인 보호 장치입니다.
한 번 끊어지면 교체해야 합니다.

```
    일반 퓨즈 동작:

    정상 시:
    V_IN ──── [퓨즈: 정상] ──── 회로
              ────────────
              (전류 통과)

    과전류 시:
    V_IN ──── [퓨즈: 끊김!] ──── 회로
              ────  ────
              (전류 차단 → 회로 보호)

    ※ 끊어진 퓨즈는 교체해야 함
```

#### 퓨즈 선정 방법

```
    ┌─────────────────────────────────────────────────────┐
    │              퓨즈 선정 공식                           │
    │                                                     │
    │  퓨즈 정격 = 정상 동작 전류 × 1.5 ~ 2.0             │
    │                                                     │
    │  예: 정상 전류 500mA                                │
    │      퓨즈 정격 = 500 × 1.5 = 750mA                 │
    │      → 1A 퓨즈 선택 (표준 규격 중 가장 가까운 것)   │
    │                                                     │
    │  주의: 너무 작으면 정상 동작 중 끊어짐               │
    │        너무 크면 보호 기능 무의미                     │
    └─────────────────────────────────────────────────────┘
```

#### 퓨즈 종류

| 종류 | 특성 | 사용처 |
|------|------|--------|
| **속동형 (Fast-blow)** | 빠르게 끊어짐 | 반도체 보호 |
| **지연형 (Slow-blow)** | 순간 과전류에는 버팀 | 모터, 돌입 전류가 있는 회로 |

> **ESP32 프로젝트용**: Wi-Fi 활성화 시 순간 전류가 높으므로 **지연형** 퓨즈를 추천합니다.

### 2.3 PTC 자동복구 퓨즈 (Resettable Fuse)

**PTC (Positive Temperature Coefficient)** 퓨즈는 과전류로 온도가 올라가면
저항이 급격히 증가하여 전류를 차단합니다. 온도가 내려가면 자동으로 복구됩니다.

```
    PTC 퓨즈 동작 원리:

    저항(Ω)
     │
     │                          ╱ 고저항 상태
     │                        ╱   (전류 거의 차단)
     │                      ╱
     │                    ╱
     │         ──────────╱──── 트립 온도
     │        │
     │        │   전환점 (급격한 저항 증가)
     │────────┘
     │  저저항 상태
     │  (정상 동작, 전류 통과)
     │
     └─────────────────────────────▶ 온도(°C)

    동작 과정:
    1. 정상: 낮은 저항 (수십 mΩ ~ 수 Ω) → 전류 통과
    2. 과전류: 자체 발열 → 온도 상승 → 저항 급증 → 전류 차단
    3. 원인 제거 후: 냉각 → 저항 감소 → 자동 복구!
```

#### PTC vs 일반 퓨즈 비교

| 특성 | 일반 퓨즈 | PTC (자동복구) |
|------|----------|---------------|
| 동작 후 | 교체 필요 | **자동 복구** |
| 응답 속도 | 빠름 | 상대적으로 느림 (수 ms~수 초) |
| 정상 시 저항 | 매우 낮음 | 낮음 (수십~수백 mΩ) |
| 크기 | 다양 | 소형 (SMD 가능) |
| 비용 | 저렴 | 약간 비쌈 |
| 재사용 | 불가 | **가능** |
| **추천 사용처** | 높은 신뢰성 필요 | **프로토타입, 취미** |

#### 추천 PTC 퓨즈

| 부품 | 유지 전류 | 트립 전류 | 사용처 |
|------|----------|----------|--------|
| RXEF010 | 100mA | 200mA | 소형 센서 보호 |
| RXEF050 | 500mA | 1A | ESP32 일반 프로젝트 |
| RXEF110 | 1.1A | 2.2A | 모터, 릴레이 포함 프로젝트 |
| RXEF250 | 2.5A | 5A | 고전력 프로젝트 |

### 2.4 퓨즈 연결 위치

```
    퓨즈는 반드시 전원 입력부의 + 라인에 직렬로 연결!

    외부 전원                                    회로
    ┌──────┐    퓨즈                           ┌──────┐
    │  +   ├──── [F1] ────────────────────────▶│  +   │
    │      │                                   │      │
    │  -   ├──────────────────────────────────▶│  -   │
    └──────┘                                   └──────┘

    여러 보호 소자 조합:

    V_IN(+) ── [퓨즈] ── [역극성보호] ── [레귤레이터] ── 회로
    V_IN(-) ─────────────────────────────────────────── GND
```

---

## 3. TVS 다이오드: 서지(과전압) 보호

### 3.1 서지(Surge)란?

**서지(Surge)**는 매우 짧은 시간(수 ns ~ 수 ms) 동안 발생하는 **비정상적으로 높은 전압**입니다.

```
    서지의 원인:
    ─────────────────────────────────────────
    - 번개 (낙뢰에 의한 유도 전압)
    - 정전기 방전 (ESD)
    - 인덕티브 부하 스위칭 (릴레이, 모터 등)
    - 전원 라인의 스위칭 노이즈
    - 전원 어댑터의 글리치
    ─────────────────────────────────────────

    서지 파형:

    전압(V)
     │
  100V┤    ╲
     │   ╱  ╲
     │  ╱    ╲          서지 (수 μs ~ 수 ms)
     │ ╱      ╲
  50V┤╱        ╲
     │          ╲
   5V┤───────────╲──────────── 정상 전압
     │            ╲╱
     └──────────────────────▶ 시간
```

### 3.2 TVS 다이오드란?

**TVS (Transient Voltage Suppressor)** 다이오드는 서지 전압이 인가되면
**매우 빠르게 (수 ns)** 전도하여 과전압을 GND로 흡수합니다.

```
    TVS 다이오드 동작:

    정상 시 (V < V_BR):
    ────────── TVS ──────────
              (차단)          → 전류 안 흐름, 회로에 영향 없음

    서지 발생 시 (V > V_BR):
    ────────── TVS ──────────
              (도통)          → 서지 전류를 GND로 흡수!
                 │
                GND

    V-I 특성 곡선:

    전류(I)
     │          ╱ 클램핑 동작
     │        ╱   (서지 전류 흡수)
     │      ╱
     │    ╱─── V_BR (항복 전압)
     │   │
     │   │
     │───┘     누설 전류 (매우 작음)
     └────────────────────▶ 전압(V)
         V_RWM  V_BR  V_C
```

#### TVS 다이오드 핵심 파라미터

| 파라미터 | 영문 | 설명 |
|---------|------|------|
| V_RWM | Reverse Working Maximum | 정상 동작 시 최대 허용 전압 |
| V_BR | Breakdown Voltage | 항복(도통 시작) 전압 |
| V_C | Clamping Voltage | 서지 시 출력 클램핑 전압 |
| P_PP | Peak Pulse Power | 최대 펄스 전력 |

### 3.3 TVS 다이오드 연결 방법

```
    전원 라인 보호:

    V_IN ──── [퓨즈] ────┬──── 회로 V_CC
                         │
                        [TVS]
                         │
    GND ─────────────────┴──── GND

    신호 라인 보호 (GPIO 등):

    외부 신호 ──────────┬──── ESP32 GPIO
                        │
                       [TVS]
                        │
                       GND

    양방향 TVS (AC 신호 보호):

    신호 ────────┬──── 회로
                 │
            ┌────┴────┐
            │ 양방향   │
            │  TVS    │
            └────┬────┘
                 │
                GND
```

### 3.4 ESP32 프로젝트용 TVS 선정

| 보호 대상 | 정상 전압 | 추천 TVS (V_RWM) | 클램핑 전압 |
|----------|----------|-----------------|-----------|
| 3.3V 전원 | 3.3V | SMBJ3.3A (3.3V) | ~5.5V |
| 5V 전원 | 5V | SMBJ5.0A (5.0V) | ~8.0V |
| GPIO (3.3V) | 0~3.3V | PESD3V3S1UB (3.3V) | ~8V |
| USB 전원 | 5V | SMBJ5.0A (5.0V) | ~8.0V |

---

## 4. 정전기(ESD) 보호

### 4.1 ESD란?

**ESD (Electro-Static Discharge)**는 정전기가 방전되는 현상입니다.
일상에서 문손잡이를 잡을 때 "탁" 하는 것이 바로 ESD입니다.

```
    ESD의 위력:
    ─────────────────────────────────────────
    사람이 느끼는 최소 정전기: ~3,000V
    문손잡이 정전기:         ~5,000V
    카펫 위 보행 시:         ~10,000~20,000V
    IC가 손상되는 전압:       ~100V 이하!

    → 사람이 느끼지 못하는 수준에서도
      IC는 이미 손상될 수 있습니다!
    ─────────────────────────────────────────
```

### 4.2 ESD 보호 방법

#### 1) 설계 단계에서의 ESD 보호

```
    ┌─────────────────────────────────────────────────────┐
    │              ESD 보호 설계 가이드                     │
    ├─────────────────────────────────────────────────────┤
    │                                                     │
    │  1. 외부 커넥터에 ESD 보호 소자 추가                │
    │     (USB, 센서 커넥터, 스위치 등)                    │
    │                                                     │
    │  2. 미사용 GPIO를 GND 또는 내부 풀다운으로 설정     │
    │                                                     │
    │  3. PCB에서 ESD 경로 설계                           │
    │     (ESD 전류가 IC를 거치지 않고 GND로 가도록)      │
    │                                                     │
    │  4. 케이스(인클로저) 사용                            │
    │     (외부 접촉 최소화)                               │
    │                                                     │
    │  5. 접지(어스) 연결                                  │
    │     (정전기를 땅으로 흘려보냄)                        │
    │                                                     │
    └─────────────────────────────────────────────────────┘
```

#### 2) ESD 보호 소자

```
    USB 커넥터의 ESD 보호 예:

    USB                  ESD 보호            ESP32
    ┌──────┐           ┌──────┐           ┌──────┐
    │ VBUS ├─────┬─────┤      ├───────────┤ VCC  │
    │      │     │     │      │           │      │
    │  D+  ├──┬──│─────┤ ESD  ├──────┬────┤  D+  │
    │      │  │  │     │ 보호  │     │    │      │
    │  D-  ├──│──│─────┤ 소자  ├──┬──│────┤  D-  │
    │      │  │  │     │      │  │  │    │      │
    │ GND  ├──┴──┴─────┤      ├──┴──┴────┤ GND  │
    └──────┘           └──────┘           └──────┘

    추천 ESD 보호 IC:
    - PRTR5V0U2X: USB 2.0용 ESD 보호
    - USBLC6-2SC6: USB용 저용량 ESD 보호
    - PESD3V3S2UT: 3.3V GPIO용 ESD 보호
```

### 4.3 작업 시 ESD 방지 습관

| 방지 방법 | 설명 |
|----------|------|
| **정전기 방지 손목밴드** | 손목에 차고 접지에 연결 |
| **접지된 매트** | 작업대에 정전기 방지 매트 깔기 |
| **금속 만지기** | 부품 만지기 전 금속 물체 만져서 방전 |
| **습도 유지** | 가습기로 습도 40% 이상 유지 |
| **정전기 방지 봉투** | IC는 정전기 방지 봉투에 보관 |
| **천천히 움직이기** | 빠른 움직임은 정전기 발생 증가 |

---

## 5. 과열 보호 (Thermal Protection)

### 5.1 과열의 원인

| 원인 | 설명 |
|------|------|
| 과전류 | 설계 초과 전류로 인한 발열 |
| 단락 | 회로 단락으로 대전류 → 발열 |
| 환경 온도 | 밀폐 공간, 직사광선 등 |
| 방열 부족 | 방열판 없이 고출력 소자 사용 |
| 비효율적 레귤레이터 | LDO에서의 과도한 열 발생 |

### 5.2 써멀 셧다운 (Thermal Shutdown)

대부분의 현대 IC(레귤레이터, 전원 IC 등)에는 **써멀 셧다운** 기능이 내장되어 있습니다.
칩 온도가 일정 수준(보통 150~170도C)을 초과하면 자동으로 동작을 멈춥니다.

```
    써멀 셧다운 동작:

    온도(°C)
    170 ┤─ ─ ─ ─ ─ ─ ── ─── 셧다운 온도
        │               ╱╲
    150 ┤              ╱  ╲  ← 셧다운! (출력 OFF)
        │            ╱    ╲
    130 ┤           ╱      ╲   ← 히스테리시스
        │          ╱        ╲     (약간 낮은 온도에서 복귀)
    110 ┤        ╱          ╲
        │       ╱            ╲─ 복귀 (출력 ON)
     90 ┤      ╱              ╲
        │     ╱                ╱╲
     70 ┤────╱                ╱  ╲──
        │                          동작 반복
     50 ┤                          (문제 미해결 시)
        └──────────────────────────────▶ 시간
```

> **주의**: 써멀 셧다운에 의존하지 마세요! 이것은 **최후의 안전장치**입니다.
> 정상적으로 동작할 때는 써멀 셧다운이 발생하지 않아야 합니다.

### 5.3 방열 대책

```
    ┌─────────────────────────────────────────────────────┐
    │               방열 대책 종류                         │
    ├─────────────────────────────────────────────────────┤
    │                                                     │
    │  1. 방열판 (Heat Sink)                              │
    │     - 알루미늄/구리 방열판을 IC에 부착              │
    │     - 열전도 패드/서멀 그리스 사용                   │
    │                                                     │
    │  2. 통풍 (Ventilation)                              │
    │     - 케이스에 통풍구 설계                           │
    │     - 필요시 소형 팬 추가                            │
    │                                                     │
    │  3. PCB 방열                                        │
    │     - 넓은 구리 패턴으로 열 분산                     │
    │     - 써멀 비아(Thermal Via) 사용                    │
    │                                                     │
    │  4. 전원 설계 개선                                   │
    │     - LDO를 DC-DC로 교체 (근본적 해결)              │
    │     - 입출력 전압차 줄이기                            │
    │                                                     │
    └─────────────────────────────────────────────────────┘
```

---

## 6. 실용적 보호 회로 구성 예제

### 6.1 기본 보호 회로 (최소 구성)

취미 프로젝트나 프로토타입에 적합한 최소한의 보호 회로입니다.

```
    최소 보호 회로:

    외부 전원    퓨즈        역극성 보호       레귤레이터      회로
    ┌────┐   ┌──────┐    ┌──────────┐     ┌──────────┐   ┌────┐
    │ +  ├───┤ PTC  ├────┤ 다이오드  ├─────┤ AMS1117  ├───┤ +  │
    │    │   │ 500mA│    │ 1N5819   │     │  5V→3.3V │   │    │
    │ -  ├───┴──────┴────┤          ├─┬───┤          ├───┤ -  │
    └────┘               └──────────┘ │   └──────────┘   └────┘
                                      │
                                   [100μF]  디커플링
                                      │     커패시터
                                     GND

    부품 목록:
    - F1: PTC 퓨즈 500mA (RXEF050)
    - D1: 쇼트키 다이오드 1N5819
    - U1: AMS1117-3.3 LDO 레귤레이터
    - C1: 전해 커패시터 100μF / 16V
    - C2: 세라믹 커패시터 100nF (0.1μF)
    - C3: 전해 커패시터 22μF / 10V (출력)
```

### 6.2 표준 보호 회로 (권장 구성)

좀 더 안정적인 보호가 필요한 프로젝트에 적합합니다.

```
    표준 보호 회로:

    외부     PTC    역극성     TVS      DC-DC     LDO      ESP32
    전원     퓨즈   보호       서지보호   컨버터    레귤레이터  + 센서
    ┌──┐   ┌──┐   ┌──┐      ┌──┐    ┌──────┐  ┌─────┐   ┌───┐
    │+ ├───┤F1├───┤Q1├──┬───┤D2├──┬─┤LM2596├──┤AMS  ├───┤   │
    │  │   │  │   │  │  │   │  │  │ │12→5V │  │1117 │   │ESP│
    │  │   │  │   │  │  │   │  │  │ └──────┘  │5→3.3│   │32 │
    │- ├───┴──┴───┴──┴──┴───┴──┴──┴──────────┴─────┴───┤   │
    └──┘                                                └───┘

    보호 레이어:
    Layer 1: PTC 퓨즈 ─── 과전류 보호 (자동 복구)
    Layer 2: P-MOSFET ─── 역극성 보호 (저전압강하)
    Layer 3: TVS 다이오드 ─ 서지/과전압 보호
    Layer 4: DC-DC ─────── 효율적 전압 변환
    Layer 5: LDO ─────────  노이즈 제거, 정밀 전압
```

### 6.3 ESP32 GPIO 보호

ESP32의 GPIO 핀을 외부 장치와 연결할 때의 보호 회로입니다.

```
    GPIO 보호 회로:

    외부 장치                              ESP32
    ┌─────────┐                           ┌─────────┐
    │         │    R_series    ESD/TVS     │         │
    │  신호   ├────┤├──────┬───┤├──────────┤ GPIO    │
    │         │   (100Ω)   │  (3.3V)      │         │
    └─────────┘            │              └─────────┘
                          GND

    구성 요소:
    1. 직렬 저항 (100~470Ω): 과전류 제한
    2. TVS/ESD 다이오드: 서지 보호
    3. (선택) 클램핑 다이오드: 3.3V+0.3V 이상 전압 차단

    클램핑 다이오드를 추가한 완전한 보호:

    외부 신호                              ESP32 GPIO
        │                                     │
        ├── [R: 100Ω] ──┬────────────────────┤
        │                │                    │
        │            ┌───┤                    │
        │            │   │                    │
        │          [D1]  [D2]                 │
        │            │   │                    │
        │          3.3V  GND                  │
        │                                     │

    D1: 3.3V로 클램핑 (신호가 3.3V+V_F 이상이면 도통)
    D2: GND로 클램핑 (신호가 -V_F 이하이면 도통)
```

### 6.4 릴레이 구동 시 보호 (플라이백 다이오드)

릴레이나 모터 같은 **인덕티브 부하**를 끌 때 발생하는 **역기전력(Back-EMF)**으로부터
구동 트랜지스터를 보호합니다.

```
    릴레이 구동 보호 회로:

                     VCC (5V)
                      │
                  ┌───┴───┐
                  │       │
                  │ 릴레이  │
                  │ 코일   │
                  │       │
                  └───┬───┘
                      │
                  ┌───┤ ◀── D1: 플라이백 다이오드 (1N4148)
                  │   │      역기전력을 흡수!
                  │   │
                  │   │
    ESP32 GPIO ───┤├──┤
                 R_B  │
               (1kΩ) ┌┴┐
                     │Q1│ ◀── NPN 트랜지스터 (2N2222)
                     │  │     또는 N-MOSFET
                     └┬┘
                      │
                     GND

    ⚠️ 플라이백 다이오드 없이 릴레이를 끄면:
    - 역기전력 ~50~100V 발생!
    - 트랜지스터 파괴
    - ESP32 GPIO 손상 가능
```

---

## 7. 보호 소자 배치 순서

전원 입력부에 보호 소자를 배치하는 **추천 순서**입니다.

```
    외부 전원 입력에서 회로까지의 보호 순서:

    외부   ①      ②        ③       ④        ⑤
    전원 → 퓨즈 → 역극성 → TVS → 필터 → 레귤레이터 → 회로
    입력   (PTC)  보호     서지    (LC)    (LDO/DC-DC)
                  (다이오드 보호
                   /MOSFET)

    각 단계의 역할:
    ① 퓨즈:    과전류 차단 (최전방 방어)
    ② 역극성:  잘못된 극성 차단
    ③ TVS:    서지(과전압) 흡수
    ④ 필터:    노이즈 제거 (필요 시)
    ⑤ 레귤레이터: 안정된 전압으로 변환

    ※ 모든 보호 소자가 항상 필요한 것은 아닙니다.
       프로젝트의 요구 사항과 예산에 맞게 선택하세요.
```

---

## 8. 보호 회로 설계 체크리스트

```
    ┌─────────────────────────────────────────────────────┐
    │           보호 회로 설계 체크리스트                    │
    ├─────────────────────────────────────────────────────┤
    │                                                     │
    │  □ 과전류 보호 (퓨즈 또는 PTC)가 있는가?            │
    │    - 정격: 정상 전류의 1.5~2배                       │
    │                                                     │
    │  □ 역극성 보호가 있는가?                             │
    │    - 다이오드 또는 P-MOSFET                          │
    │                                                     │
    │  □ 서지/과전압 보호가 있는가? (필요한 경우)          │
    │    - TVS 다이오드 (V_RWM > 정상 전압)               │
    │                                                     │
    │  □ 외부 커넥터에 ESD 보호가 있는가?                  │
    │    - USB, 센서 커넥터 등                             │
    │                                                     │
    │  □ 인덕티브 부하에 플라이백 다이오드가 있는가?       │
    │    - 릴레이, 모터, 솔레노이드 등                     │
    │                                                     │
    │  □ 디커플링 커패시터가 IC 근처에 있는가?             │
    │    - 각 IC의 VCC-GND 사이에 100nF                   │
    │                                                     │
    │  □ 레귤레이터의 발열이 허용 범위인가?                │
    │    - P_열 = (V_IN - V_OUT) × I_OUT                  │
    │                                                     │
    │  □ 전원 시퀀싱이 올바른가? (여러 전압 사용 시)       │
    │    - 3.3V가 5V보다 먼저 켜지면 안 됨 등              │
    │                                                     │
    └─────────────────────────────────────────────────────┘
```

---

## 9. 비용 대비 보호 수준 가이드

| 프로젝트 수준 | 필수 보호 | 선택 보호 | 비용 추가 |
|-------------|----------|----------|----------|
| **취미/학습** | 디커플링 커패시터 | PTC 퓨즈, 다이오드 역극성 보호 | ~500원 |
| **프로토타입** | 퓨즈 + 역극성 보호 + 디커플링 | TVS, 플라이백 다이오드 | ~2,000원 |
| **제품/양산** | 전체 보호 (퓨즈+역극성+TVS+ESD) | EMI 필터, 써지 어레스터 | ~5,000원 이상 |

---

## 핵심 정리

```
┌─────────────────────────────────────────────────────────┐
│                      핵심 정리                           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. 역극성 보호:                                        │
│     - 간단: 쇼트키 다이오드 (1N5819)                    │
│     - 고급: P-MOSFET (전압 강하 최소)                   │
│                                                         │
│  2. 과전류 보호:                                        │
│     - 일반 퓨즈: 한 번 쓰고 교체                        │
│     - PTC 퓨즈: 자동 복구 (프로토타입에 추천)           │
│     - 정격 = 정상 전류 × 1.5~2.0                       │
│                                                         │
│  3. 서지(과전압) 보호:                                  │
│     - TVS 다이오드로 서지 흡수                          │
│     - V_RWM > 정상 동작 전압                            │
│                                                         │
│  4. ESD 보호:                                           │
│     - 외부 커넥터에 ESD 보호 소자 추가                  │
│     - 작업 시 정전기 방지 습관 중요                     │
│                                                         │
│  5. 과열 보호:                                          │
│     - 방열판, 통풍으로 대응                             │
│     - 써멀 셧다운은 최후 수단                           │
│     - 근본 해결: 효율적인 전원 설계 (DC-DC)             │
│                                                         │
│  6. 인덕티브 부하(릴레이, 모터):                        │
│     - 반드시 플라이백 다이오드 추가!                    │
│                                                         │
│  7. 디커플링 커패시터:                                  │
│     - 모든 IC의 VCC-GND에 100nF                        │
│     - 가장 기본적이면서 효과적인 보호                   │
│                                                         │
│  8. 보호 소자 배치 순서:                                │
│     퓨즈 → 역극성 → TVS → 필터 → 레귤레이터            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 연습 문제

### 문제 1: 보호 소자 선택
ESP32 + 릴레이 + 온도 센서 시스템 (5V 어댑터, 최대 500mA)에 필요한
보호 소자를 나열하고 선정 근거를 설명하세요.

<details>
<summary>정답 보기</summary>

```
1. PTC 퓨즈: RXEF110 (유지 1.1A, 트립 2.2A)
   - 정상 500mA, 마진 포함 1A 이상 필요
   - ESP32 돌입 전류 고려하여 지연 특성의 PTC 선택

2. 역극성 보호: 1N5819 쇼트키 다이오드
   - 5V 시스템에서 0.3V 강하는 허용 가능
   - (고효율 필요 시 P-MOSFET SI2301)

3. 디커플링 커패시터: 100nF x 2개 + 100μF x 1개
   - ESP32 VCC-GND: 100nF
   - 센서 VCC-GND: 100nF
   - 전원 입력: 100μF 전해

4. 플라이백 다이오드: 1N4148
   - 릴레이 코일의 역기전력 보호

5. (선택) TVS: SMBJ5.0A
   - 외부 전원의 서지로부터 보호
```
</details>

### 문제 2: 역극성 보호 비교
12V/2A 시스템에서 다이오드 방식과 P-MOSFET 방식의 전력 손실을 각각 계산하세요.
(다이오드 V_F=0.5V, MOSFET R_DS(on)=0.065Ω)

<details>
<summary>정답 보기</summary>

```
다이오드 방식:
P = V_F × I = 0.5V × 2A = 1.0W
→ 꽤 뜨거움, 방열 고려 필요

P-MOSFET 방식:
V_DS = I × R_DS(on) = 2A × 0.065Ω = 0.13V
P = V_DS × I = 0.13V × 2A = 0.26W
→ 거의 발열 없음

비교:
다이오드: 1.0W → 12V에서 8.3% 손실
MOSFET: 0.26W → 12V에서 1.1% 손실

→ P-MOSFET이 약 3.8배 더 효율적!
   배터리 구동이나 고전류 시스템에서는
   P-MOSFET 방식을 사용하는 것이 유리합니다.
```
</details>

---

> **Phase 5 완료!** 전원 설계의 기본을 모두 학습했습니다.
> `examples/power_budget_calculator.py`를 실행하여 실습해 보세요.
